pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	cls()
	mode="start"
end

function _update60()
	if mode =="game" then
		update_game()
	elseif mode == "start" then
		update_start()
	elseif mode == "gameover" then
		update_gameover()
	end
end

function _draw()
	if mode =="game" then
		draw_game()
	elseif mode == "start" then
		draw_start()
	elseif mode == "gameover" then
		draw_gameover()
	end
end

function draw_start()
	print('pico hero breakout', 30, 40, 7)
	print('press ❎ to start',32,80,11)
end

function draw_gameover()
	rectfill(0, 60, 128, 75, 0)
	print("game over", 45, 62, 7)
	print("press ❎ to restart", 25, 69, 6)
end

function update_start()
	if btn(❎) then
		startgame()
	end
end

function update_gameover()
	if btn(❎) then
		startgame()
	end
end

function update_game()
	local button_press=false 
	local next_x, next_y
	
	--left
	if btn(⬅️) then
		pad_dx=-pad_speed
		button_press=true
		--pad_x-=pad_speed
	end

	--right
	if btn(➡️) then
		pad_dx=pad_speed
		button_press=true
		--pad_x+=pad_speed
	end
	
	if not button_press then
		pad_dx=pad_dx/1.4
	end
	
	pad_x+=pad_dx

	next_x = ball_x+ball_dx 
	next_y = ball_y+ball_dy

 if next_x > 127 or next_x < 0 then
	next_x = mid(0, next_x, 127)
 	ball_dx = -ball_dx
 	sfx(0)
 end

 if next_y < 10 then
	next_y = mid(10, next_y, 127)
 	ball_dy = -ball_dy
 	sfx(0)
 end

 if next_y > 127 then
	sfx(2)
	lives-=1
	if lives < 0 then
		gameover()
	else
		serveball()
	end	
	return
 end

 if hit_ballbox(next_x, next_y, pad_x, pad_y, pad_w, pad_h) then
	points+=1
	if deflx_ballbox(ball_x, ball_y, ball_dx, ball_dy, pad_x, pad_y, pad_w, pad_h) then
		ball_dx = -ball_dx
	else
		ball_dy = -ball_dy
	end
	sfx(1)
 end
 
 ball_x = next_x
 ball_y = next_y
end

function draw_game()
	cls(1)
	
	-- draw the ball
	circfill(ball_x,ball_y,ball_r,col)

	-- draw the paddle	
	rectfill(pad_x,pad_y, pad_x+pad_w,pad_y+pad_h,paddle_col)

	rectfill(0,0, 128, 6, 2)
	print("lives "..lives, 1,1,7)
	print("score "..points, 40,1,7)
end

function gameover()
	mode="gameover"
end

function serveball() 
	ball_x=1
	ball_y=33
	
	ball_dx=1
	ball_dy=2
end

function startgame()
	ball_r=2	
	ball_dr=0.5

	col=10
	paddle_col=7

	pad_x=52
	pad_y=120
	pad_w=24
	pad_h=3

	pad_dx=0

	pad_speed=2.5

	mode="game"

	lives=3
	points=0
	serveball()
end

function hit_ballbox(bx,by,tx,ty,tw,th)
	if by-ball_r > ty+th then return false end
	if by+ball_r < ty then return false end
	if bx-ball_r > tx+tw then return false end
	if bx+ball_r < tx then return false end
	return true
end

function deflx_ballbox(bx,by,bdx,bdy,tx,ty,tw,th)
	-- calculate wether to deflect the ball
	-- horizontally or vertically when it hits a box
	if bdx == 0 then
	 -- moving vertically
	 return false
	elseif bdy == 0 then
	 -- moving horizontally
	 return true
	else
	 -- moving diagonally
	 -- calculate slope
	 local slp = bdy / bdx
	 local cx, cy
	 -- check variants
	 if slp > 0 and bdx > 0 then
		-- moving down right
		debug1="q1"
		cx = tx-bx
		cy = ty-by
		if cx<=0 then
		 return false
		elseif cy/cx < slp then
		 return true
		else
		 return false
		end
	 elseif slp < 0 and bdx > 0 then
		debug1="q2"
		-- moving up right
		cx = tx-bx
		cy = ty+th-by
		if cx<=0 then
		 return false
		elseif cy/cx < slp then
		 return false
		else
		 return true
		end
	 elseif slp > 0 and bdx < 0 then
		debug1="q3"
		-- moving left up
		cx = tx+tw-bx
		cy = ty+th-by
		if cx>=0 then
		 return false
		elseif cy/cx > slp then
		 return false
		else
		 return true
		end
	 else
		-- moving left down
		debug1="q4"
		cx = tx+tw-bx
		cy = ty-by
		if cx>=0 then
		 return false
		elseif cy/cx < slp then
		 return false
		else
		 return true
		end
	 end
	end
	return false
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888eeeeee888888888888888888888888888888888888888888888888888888888888888888888888ff8ff8888228822888222822888888822888888228888
8888ee888ee88888888888888888888888888888888888888888888888888888888888888888888888ff888ff888222222888222822888882282888888222888
888eee8e8ee88888e88888888888888888888888888888888888888888888888888888888888888888ff888ff888282282888222888888228882888888288888
888eee8e8ee8888eee8888888888888888888888888888888888888888888888888888888888888888ff888ff888222222888888222888228882888822288888
888eee8e8ee88888e88888888888888888888888888888888888888888888888888888888888888888ff888ff888822228888228222888882282888222288888
888eee888ee888888888888888888888888888888888888888888888888888888888888888888888888ff8ff8888828828888228222888888822888222888888
888eeeeeeee888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1eee1e1e1ee111ee1eee1eee11ee1ee1111111111616166616611666166616661611166611711171111111111111111111111111111111111111111111111111
1e111e1e1e1e1e1111e111e11e1e1e1e111111111616161616161616116116111611161617111117111111111111111111111111111111111111111111111111
1ee11e1e1e1e1e1111e111e11e1e1e1e111111111616166616161666116116611666161617111117111111111111111111111111111111111111111111111111
1e111e1e1e1e1e1111e111e11e1e1e1e111111111616161116161616116116111616161617111117111111111111111111111111111111111111111111111111
1e1111ee1e1e11ee11e11eee1ee11e1e111116661166161116661616116116661666166611711171111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111666166616111611111116161111111111111666166616111611111116161111111111111666166616111611111116611616111111111111111111111111
11111616161616111611111116161111177711111616161616111611111116161111117111111616161616111611111116161616111111111111111111111111
11111661166616111611111111611111111111111661166616111611111111611111177711111661166616111611111116161161111111111111111111111111
11111616161616111611111116161111177711111616161616111611111116161111117111111616161616111611111116161616111111111111111111111111
11111666161616661666166616161111111111111666161616661666166616161111111111111666161616661666166616661616111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111666166616111611111116161111111111111666166616111611111116161111111111111666166616111611111116611616111111111111111111111111
11111616161616111611111116161111177711111616161616111611111116161111117111111616161616111611111116161616111111111111111111111111
11111661166616111611111116661111111111111661166616111611111116661111177711111661166616111611111116161666111111111111111111111111
11111616161616111611111111161111177711111616161616111611111111161111117111111616161616111611111116161116111111111111111111111111
11111666161616661666166616661111111111111666161616661666166616661111111111111666161616661666166616661666111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111eee1eee11111666166616111611111116161111171111111cc11ccc1ccc111111ee1eee11111666166616111611111116161111111711111ccc11111eee
111111e11e11111116161616161116111111161611111171111111c1111c111c11111e1e1e1e11111616161616111611111116161111117111111c1c111111e1
111111e11ee1111116611666161116111111116111111117111111c11ccc111c11111e1e1ee111111661166616111611111111611111171111111c1c111111e1
111111e11e11111116161616161116111111161611111171111111c11c11111c11111e1e1e1e11111616161616111611111116161111117111111c1c111111e1
11111eee1e1111111666161616661666166616161111171111111ccc1ccc111c11111ee11e1e11111666161616661666166616161111111711111ccc111111e1
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111166616661611161111111661161611111111111111111666166616111611111116611616111111111111111111111111111111111111111111111111
11111111161616161611161111111616161611111777111111111616161616111611111116161616111111111111111111111111111111111111111111111111
11111111166116661611161111111616116111111111111117771661166616111611111116161161111111111111111111111111111111111111111111111111
11111111161616161611161111111616161611111777111111111616161616111611111116161616111111111111111111111111111111111111111111111111
11111111166616161666166616661666161611111111111111111666161616661666166616661616111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111bb1bbb1b1b11711ccc1171111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111b111b111b1b17111c1c1117111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111bbb1bb111b117111c1c1117111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111b1b111b1b17111c1c1117111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111bb11b111b1b11711ccc1171111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111eee1ee11ee11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111e111e1e1e1e1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111ee11e1e1e1e1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111e111e1e1e1e1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111eee1e1e1eee1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111117111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111117711111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111117771111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111117777111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111117711111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111171111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111eee1eee11111666166616111611111116161111171111111cc11ccc1ccc111111ee1eee11111666166616111611111116161111111711111ccc11111eee
111111e11e11111116161616161116111111161611111171111111c1111c111c11111e1e1e1e11111616161616111611111116161111117111111c1c111111e1
111111e11ee1111116611666161116111111166611111117111111c11ccc111c11111e1e1ee111111661166616111611111116661111171111111c1c111111e1
111111e11e11111116161616161116111111111611111171111111c11c11111c11111e1e1e1e11111616161616111611111111161111117111111c1c111111e1
11111eee1e1111111666161616661666166616661111171111111ccc1ccc111c11111ee11e1e11111666161616661666166616661111111711111ccc111111e1
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111166616661611161111111661161611111111111111111666166616111611111116611616111111111111111111111111111111111111111111111111
11111111161616161611161111111616161611111777111111111616161616111611111116161616111111111111111111111111111111111111111111111111
11111111166116661611161111111616166611111111111117771661166616111611111116161666111111111111111111111111111111111111111111111111
11111111161616161611161111111616111611111777111111111616161616111611111116161116111111111111111111111111111111111111111111111111
11111111166616161666166616661666166611111111111111111666161616661666166616661666111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111bb1bbb1b1b11711ccc1171111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111b111b111b1b17111c1c1117111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111bbb1bb111b117111c1c1117111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111b1b111b1b17111c1c1117111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111bb11b111b1b11711ccc1171111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111eee1ee11ee11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111e111e1e1e1e1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111ee11e1e1e1e1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111e111e1e1e1e1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111eee1e1e1eee1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1eee1ee11ee111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1e111e1e1e1e11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1ee11e1e1e1e11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1e111e1e1e1e11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1eee1e1e1eee11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1eee1e1e1ee111ee1eee1eee11ee1ee1111111111661166616661616117111711111111111111111111111111111111111111111111111111111111111111111
1e111e1e1e1e1e1111e111e11e1e1e1e111111111616161616161616171111171111111111111111111111111111111111111111111111111111111111111111
1ee11e1e1e1e1e1111e111e11e1e1e1e111111111616166116661616171111171111111111111111111111111111111111111111111111111111111111111111
1e111e1e1e1e1e1111e111e11e1e1e1e111111111616161616161666171111171111111111111111111111111111111111111111111111111111111111111111
1e1111ee1e1e11ee11e11eee1ee11e1e111116661666161616161666117111711111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111bbb1bbb11bb1bbb1bbb1bbb1b111b1111711ccc11111ccc111111111cc11ccc1ccc111111111cc11ccc1ccc111111111cc1117111111111111111111111
11111b1b1b111b1111b11b1111b11b111b1117111c1c11111c1c1111111111c1111c111c1111111111c1111c111c1111111111c1111711111111111111111111
11111bb11bb11b1111b11bb111b11b111b1117111c1c11111c1c1111111111c11ccc111c1111111111c11ccc111c1111111111c1111711111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
82888222822882228888822882228882822282228888888888888888888888888888888888888888888888888888822282288882822282288222822288866688
82888828828282888888882882888828888282888888888888888888888888888888888888888888888888888888828288288828828288288282888288888888
82888828828282288888882882228828882282228888888888888888888888888888888888888888888888888888822288288828822288288222822288822288
82888828828282888888882888828828888288828888888888888888888888888888888888888888888888888888888288288828828288288882828888888888
82228222828282228888822282228288822282228888888888888888888888888888888888888888888888888888888282228288822282228882822288822288
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

__sfx__
0001000012230132201422015220182101c210202102021004200032000120000200002000020000200002000020000200000000d2000b2000820007200062000420002200002000020003000020000000000000
0001000008750097500b7500c7500d7500e7500d7500a750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200001b4501745014450124500f4500b4500a45009450063500535004340023400033000330003500035000350003500000000000000000000000000000000000000000000000000000000000000000000000
